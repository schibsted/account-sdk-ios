//
// Copyright 2011 - 2020 Schibsted Products & Technology AS.
// Licensed under the terms of the MIT license. See LICENSE in the project root.
//

import CoreTelephony
import Foundation

struct CountryDialingCodeHelper {
    // map of MCC to country code prefix
    // got this from: https://gist.github.com/willyaranda/11376151
    static let mccToDialingCode = [
        "0": "+0",
        "202": "+30",
        "204": "+31",
        "206": "+32",
        "208": "+33",
        "212": "+377",
        "213": "+376",
        "214": "+34",
        "216": "+36",
        "218": "+387",
        "219": "+385",
        "220": "+381",
        "222": "+39",
        "226": "+40",
        "228": "+41",
        "230": "+420",
        "231": "+421",
        "232": "+43",
        "234": "+44",
        "235": "+44",
        "238": "+45",
        "240": "+46",
        "242": "+47",
        "244": "+358",
        "246": "+370",
        "247": "+371",
        "248": "+372",
        "250": "+79",
        "255": "+380",
        "257": "+375",
        "259": "+373",
        "260": "+48",
        "262": "+49",
        "266": "+350",
        "268": "+351",
        "270": "+352",
        "272": "+353",
        "274": "+354",
        "276": "+355",
        "278": "+356",
        "280": "+357",
        "282": "+995",
        "283": "+374",
        "284": "+359",
        "286": "+90",
        "288": "+298",
        "289": "+7",
        "290": "+299",
        "292": "+378",
        "293": "+386",
        "294": "+389",
        "295": "+423",
        "297": "+382",
        "302": "+1",
        "308": "+508",
        "310": "+1",
        "311": "+1",
        "312": "+1",
        "316": "+1",
        "334": "+52",
        "338": "+1876",
        "340": "+590",
        "342": "+1246",
        "344": "+1268",
        "346": "+1345",
        "348": "+284",
        "350": "+1441",
        "352": "+1473",
        "354": "+1664",
        "356": "+1869",
        "358": "+1758",
        "360": "+1784",
        "362": "+599",
        "363": "+297",
        "364": "+1242",
        "365": "+1264",
        "366": "+1767",
        "368": "+53",
        "370": "+1809",
        "372": "+509",
        "374": "+1868",
        "376": "+1340",
        "400": "+2000",
        "401": "+7",
        "402": "+975",
        "404": "+91",
        "405": "+91",
        "410": "+92",
        "412": "+93",
        "413": "+94",
        "414": "+95",
        "415": "+961",
        "416": "+962",
        "417": "+963",
        "418": "+964",
        "419": "+965",
        "420": "+966",
        "421": "+967",
        "422": "+968",
        "424": "+971",
        "425": "+970",
        "426": "+973",
        "427": "+974",
        "428": "+976",
        "429": "+977",
        "430": "+971",
        "431": "+971",
        "432": "+98",
        "434": "+998",
        "436": "+992",
        "437": "+996",
        "438": "+993",
        "440": "+81",
        "441": "+81",
        "450": "+82",
        "452": "+84",
        "454": "+852",
        "455": "+853",
        "456": "+855",
        "457": "+856",
        "460": "+86",
        "466": "+886",
        "467": "+850",
        "470": "+880",
        "472": "+960",
        "502": "+60",
        "505": "+61",
        "510": "+62",
        "514": "+670",
        "515": "+63",
        "520": "+66",
        "525": "+65",
        "528": "+673",
        "530": "+64",
        "537": "+675",
        "539": "+676",
        "540": "+677",
        "541": "+678",
        "542": "+679",
        "544": "+684",
        "545": "+686",
        "546": "+687",
        "547": "+689",
        "548": "+682",
        "549": "+685",
        "550": "+691",
        "602": "+20",
        "603": "+213",
        "604": "+212",
        "605": "+216",
        "606": "+218",
        "607": "+220",
        "608": "+221",
        "609": "+222",
        "610": "+223",
        "611": "+224",
        "612": "+225",
        "613": "+226",
        "614": "+227",
        "615": "+228",
        "616": "+229",
        "617": "+230",
        "618": "+231",
        "619": "+232",
        "620": "+233",
        "621": "+234",
        "622": "+235",
        "623": "+236",
        "624": "+237",
        "625": "+238",
        "626": "+239",
        "627": "+240",
        "628": "+241",
        "629": "+242",
        "630": "+243",
        "631": "+244",
        "632": "+245",
        "633": "+248",
        "634": "+249",
        "635": "+250",
        "636": "+251",
        "637": "+252",
        "638": "+253",
        "639": "+254",
        "640": "+255",
        "641": "+256",
        "642": "+257",
        "643": "+258",
        "645": "+260",
        "646": "+261",
        "647": "+262",
        "648": "+263",
        "649": "+264",
        "650": "+265",
        "651": "+266",
        "652": "+267",
        "653": "+268",
        "654": "+269",
        "655": "+27",
        "657": "+291",
        "702": "+501",
        "704": "+502",
        "706": "+503",
        "708": "+504",
        "710": "+505",
        "712": "+506",
        "714": "+507",
        "716": "+51",
        "722": "+54",
        "724": "+55",
        "730": "+56",
        "732": "+57",
        "734": "+58",
        "736": "+591",
        "738": "+592",
        "740": "+593",
        "744": "+595",
        "746": "+597",
        "748": "+598",
        "901": "+870",
    ]

    // all of the timezones from NSTimeZone.knownTimeZoneNames()
    // since most people have their time zone set "correctly", this is an ok fallback
    // FIXME: collect them all!
    static let timeZoneToDialingCode: [String: String?] = [
        "Europe/Copenhagen": "+45",
        "Europe/London": "+44",
        "Europe/Oslo": "+47",
        "Europe/Stockholm": "+46",

        "Africa/Abidjan": nil,
        "Africa/Accra": nil,
        "Africa/Addis_Ababa": nil,
        "Africa/Algiers": nil,
        "Africa/Asmara": nil,
        "Africa/Bamako": nil,
        "Africa/Bangui": nil,
        "Africa/Banjul": nil,
        "Africa/Bissau": nil,
        "Africa/Blantyre": nil,
        "Africa/Brazzaville": nil,
        "Africa/Bujumbura": nil,
        "Africa/Cairo": nil,
        "Africa/Casablanca": nil,
        "Africa/Ceuta": nil,
        "Africa/Conakry": nil,
        "Africa/Dakar": nil,
        "Africa/Dar_es_Salaam": nil,
        "Africa/Djibouti": nil,
        "Africa/Douala": nil,
        "Africa/El_Aaiun": nil,
        "Africa/Freetown": nil,
        "Africa/Gaborone": nil,
        "Africa/Harare": nil,
        "Africa/Johannesburg": nil,
        "Africa/Juba": nil,
        "Africa/Kampala": nil,
        "Africa/Khartoum": nil,
        "Africa/Kigali": nil,
        "Africa/Kinshasa": nil,
        "Africa/Lagos": nil,
        "Africa/Libreville": nil,
        "Africa/Lome": nil,
        "Africa/Luanda": nil,
        "Africa/Lubumbashi": nil,
        "Africa/Lusaka": nil,
        "Africa/Malabo": nil,
        "Africa/Maputo": nil,
        "Africa/Maseru": nil,
        "Africa/Mbabane": nil,
        "Africa/Mogadishu": nil,
        "Africa/Monrovia": nil,
        "Africa/Nairobi": nil,
        "Africa/Ndjamena": nil,
        "Africa/Niamey": nil,
        "Africa/Nouakchott": nil,
        "Africa/Ouagadougou": nil,
        "Africa/Porto-Novo": nil,
        "Africa/Sao_Tome": nil,
        "Africa/Tripoli": nil,
        "Africa/Tunis": nil,
        "Africa/Windhoek": nil,
        "America/Adak": nil,
        "America/Anchorage": nil,
        "America/Anguilla": nil,
        "America/Antigua": nil,
        "America/Araguaina": nil,
        "America/Argentina/Buenos_Aires": nil,
        "America/Argentina/Catamarca": nil,
        "America/Argentina/Cordoba": nil,
        "America/Argentina/Jujuy": nil,
        "America/Argentina/La_Rioja": nil,
        "America/Argentina/Mendoza": nil,
        "America/Argentina/Rio_Gallegos": nil,
        "America/Argentina/Salta": nil,
        "America/Argentina/San_Juan": nil,
        "America/Argentina/San_Luis": nil,
        "America/Argentina/Tucuman": nil,
        "America/Argentina/Ushuaia": nil,
        "America/Aruba": nil,
        "America/Asuncion": nil,
        "America/Atikokan": nil,
        "America/Bahia": nil,
        "America/Bahia_Banderas": nil,
        "America/Barbados": nil,
        "America/Belem": nil,
        "America/Belize": nil,
        "America/Blanc-Sablon": nil,
        "America/Boa_Vista": nil,
        "America/Bogota": nil,
        "America/Boise": nil,
        "America/Cambridge_Bay": nil,
        "America/Campo_Grande": nil,
        "America/Cancun": nil,
        "America/Caracas": nil,
        "America/Cayenne": nil,
        "America/Cayman": nil,
        "America/Chicago": nil,
        "America/Chihuahua": nil,
        "America/Costa_Rica": nil,
        "America/Creston": nil,
        "America/Cuiaba": nil,
        "America/Curacao": nil,
        "America/Danmarkshavn": nil,
        "America/Dawson": nil,
        "America/Dawson_Creek": nil,
        "America/Denver": nil,
        "America/Detroit": nil,
        "America/Dominica": nil,
        "America/Edmonton": nil,
        "America/Eirunepe": nil,
        "America/El_Salvador": nil,
        "America/Fort_Nelson": nil,
        "America/Fortaleza": nil,
        "America/Glace_Bay": nil,
        "America/Godthab": nil,
        "America/Goose_Bay": nil,
        "America/Grand_Turk": nil,
        "America/Grenada": nil,
        "America/Guadeloupe": nil,
        "America/Guatemala": nil,
        "America/Guayaquil": nil,
        "America/Guyana": nil,
        "America/Halifax": nil,
        "America/Havana": nil,
        "America/Hermosillo": nil,
        "America/Indiana/Indianapolis": nil,
        "America/Indiana/Knox": nil,
        "America/Indiana/Marengo": nil,
        "America/Indiana/Petersburg": nil,
        "America/Indiana/Tell_City": nil,
        "America/Indiana/Vevay": nil,
        "America/Indiana/Vincennes": nil,
        "America/Indiana/Winamac": nil,
        "America/Inuvik": nil,
        "America/Iqaluit": nil,
        "America/Jamaica": nil,
        "America/Juneau": nil,
        "America/Kentucky/Louisville": nil,
        "America/Kentucky/Monticello": nil,
        "America/Kralendijk": nil,
        "America/La_Paz": nil,
        "America/Lima": nil,
        "America/Los_Angeles": nil,
        "America/Lower_Princes": nil,
        "America/Maceio": nil,
        "America/Managua": nil,
        "America/Manaus": nil,
        "America/Marigot": nil,
        "America/Martinique": nil,
        "America/Matamoros": nil,
        "America/Mazatlan": nil,
        "America/Menominee": nil,
        "America/Merida": nil,
        "America/Metlakatla": nil,
        "America/Mexico_City": nil,
        "America/Miquelon": nil,
        "America/Moncton": nil,
        "America/Monterrey": nil,
        "America/Montevideo": nil,
        "America/Montreal": nil,
        "America/Montserrat": nil,
        "America/Nassau": nil,
        "America/New_York": nil,
        "America/Nipigon": nil,
        "America/Nome": nil,
        "America/Noronha": nil,
        "America/North_Dakota/Beulah": nil,
        "America/North_Dakota/Center": nil,
        "America/North_Dakota/New_Salem": nil,
        "America/Ojinaga": nil,
        "America/Panama": nil,
        "America/Pangnirtung": nil,
        "America/Paramaribo": nil,
        "America/Phoenix": nil,
        "America/Port-au-Prince": nil,
        "America/Port_of_Spain": nil,
        "America/Porto_Velho": nil,
        "America/Puerto_Rico": nil,
        "America/Rainy_River": nil,
        "America/Rankin_Inlet": nil,
        "America/Recife": nil,
        "America/Regina": nil,
        "America/Resolute": nil,
        "America/Rio_Branco": nil,
        "America/Santa_Isabel": nil,
        "America/Santarem": nil,
        "America/Santiago": nil,
        "America/Santo_Domingo": nil,
        "America/Sao_Paulo": nil,
        "America/Scoresbysund": nil,
        "America/Shiprock": nil,
        "America/Sitka": nil,
        "America/St_Barthelemy": nil,
        "America/St_Johns": nil,
        "America/St_Kitts": nil,
        "America/St_Lucia": nil,
        "America/St_Thomas": nil,
        "America/St_Vincent": nil,
        "America/Swift_Current": nil,
        "America/Tegucigalpa": nil,
        "America/Thule": nil,
        "America/Thunder_Bay": nil,
        "America/Tijuana": nil,
        "America/Toronto": nil,
        "America/Tortola": nil,
        "America/Vancouver": nil,
        "America/Whitehorse": nil,
        "America/Winnipeg": nil,
        "America/Yakutat": nil,
        "America/Yellowknife": nil,
        "Antarctica/Casey": nil,
        "Antarctica/Davis": nil,
        "Antarctica/DumontDUrville": nil,
        "Antarctica/Macquarie": nil,
        "Antarctica/Mawson": nil,
        "Antarctica/McMurdo": nil,
        "Antarctica/Palmer": nil,
        "Antarctica/Rothera": nil,
        "Antarctica/South_Pole": nil,
        "Antarctica/Syowa": nil,
        "Antarctica/Troll": nil,
        "Antarctica/Vostok": nil,
        "Arctic/Longyearbyen": nil,
        "Asia/Aden": nil,
        "Asia/Almaty": nil,
        "Asia/Amman": nil,
        "Asia/Anadyr": nil,
        "Asia/Aqtau": nil,
        "Asia/Aqtobe": nil,
        "Asia/Ashgabat": nil,
        "Asia/Baghdad": nil,
        "Asia/Bahrain": nil,
        "Asia/Baku": nil,
        "Asia/Bangkok": nil,
        "Asia/Beirut": nil,
        "Asia/Bishkek": nil,
        "Asia/Brunei": nil,
        "Asia/Chita": nil,
        "Asia/Choibalsan": nil,
        "Asia/Chongqing": nil,
        "Asia/Colombo": nil,
        "Asia/Damascus": nil,
        "Asia/Dhaka": nil,
        "Asia/Dili": nil,
        "Asia/Dubai": nil,
        "Asia/Dushanbe": nil,
        "Asia/Gaza": nil,
        "Asia/Harbin": nil,
        "Asia/Hebron": nil,
        "Asia/Ho_Chi_Minh": nil,
        "Asia/Hong_Kong": nil,
        "Asia/Hovd": nil,
        "Asia/Irkutsk": nil,
        "Asia/Jakarta": nil,
        "Asia/Jayapura": nil,
        "Asia/Jerusalem": nil,
        "Asia/Kabul": nil,
        "Asia/Kamchatka": nil,
        "Asia/Karachi": nil,
        "Asia/Kashgar": nil,
        "Asia/Kathmandu": nil,
        "Asia/Katmandu": nil,
        "Asia/Khandyga": nil,
        "Asia/Kolkata": nil,
        "Asia/Krasnoyarsk": nil,
        "Asia/Kuala_Lumpur": nil,
        "Asia/Kuching": nil,
        "Asia/Kuwait": nil,
        "Asia/Macau": nil,
        "Asia/Magadan": nil,
        "Asia/Makassar": nil,
        "Asia/Manila": nil,
        "Asia/Muscat": nil,
        "Asia/Nicosia": nil,
        "Asia/Novokuznetsk": nil,
        "Asia/Novosibirsk": nil,
        "Asia/Omsk": nil,
        "Asia/Oral": nil,
        "Asia/Phnom_Penh": nil,
        "Asia/Pontianak": nil,
        "Asia/Pyongyang": nil,
        "Asia/Qatar": nil,
        "Asia/Qyzylorda": nil,
        "Asia/Rangoon": nil,
        "Asia/Riyadh": nil,
        "Asia/Sakhalin": nil,
        "Asia/Samarkand": nil,
        "Asia/Seoul": nil,
        "Asia/Shanghai": nil,
        "Asia/Singapore": nil,
        "Asia/Srednekolymsk": nil,
        "Asia/Taipei": nil,
        "Asia/Tashkent": nil,
        "Asia/Tbilisi": nil,
        "Asia/Tehran": nil,
        "Asia/Thimphu": nil,
        "Asia/Tokyo": nil,
        "Asia/Ulaanbaatar": nil,
        "Asia/Urumqi": nil,
        "Asia/Ust-Nera": nil,
        "Asia/Vientiane": nil,
        "Asia/Vladivostok": nil,
        "Asia/Yakutsk": nil,
        "Asia/Yekaterinburg": nil,
        "Asia/Yerevan": nil,
        "Atlantic/Azores": nil,
        "Atlantic/Bermuda": nil,
        "Atlantic/Canary": nil,
        "Atlantic/Cape_Verde": nil,
        "Atlantic/Faroe": nil,
        "Atlantic/Madeira": nil,
        "Atlantic/Reykjavik": nil,
        "Atlantic/South_Georgia": nil,
        "Atlantic/St_Helena": nil,
        "Atlantic/Stanley": nil,
        "Australia/Adelaide": nil,
        "Australia/Brisbane": nil,
        "Australia/Broken_Hill": nil,
        "Australia/Currie": nil,
        "Australia/Darwin": nil,
        "Australia/Eucla": nil,
        "Australia/Hobart": nil,
        "Australia/Lindeman": nil,
        "Australia/Lord_Howe": nil,
        "Australia/Melbourne": nil,
        "Australia/Perth": nil,
        "Australia/Sydney": nil,
        "Europe/Amsterdam": nil,
        "Europe/Andorra": nil,
        "Europe/Athens": nil,
        "Europe/Belgrade": nil,
        "Europe/Berlin": nil,
        "Europe/Bratislava": nil,
        "Europe/Brussels": nil,
        "Europe/Bucharest": nil,
        "Europe/Budapest": nil,
        "Europe/Busingen": nil,
        "Europe/Chisinau": nil,
        "Europe/Dublin": nil,
        "Europe/Gibraltar": nil,
        "Europe/Guernsey": nil,
        "Europe/Helsinki": nil,
        "Europe/Isle_of_Man": nil,
        "Europe/Istanbul": nil,
        "Europe/Jersey": nil,
        "Europe/Kaliningrad": nil,
        "Europe/Kiev": nil,
        "Europe/Lisbon": nil,
        "Europe/Ljubljana": nil,
        "Europe/Luxembourg": nil,
        "Europe/Madrid": nil,
        "Europe/Malta": nil,
        "Europe/Mariehamn": nil,
        "Europe/Minsk": nil,
        "Europe/Monaco": nil,
        "Europe/Moscow": nil,
        "Europe/Paris": nil,
        "Europe/Podgorica": nil,
        "Europe/Prague": nil,
        "Europe/Riga": nil,
        "Europe/Rome": nil,
        "Europe/Samara": nil,
        "Europe/San_Marino": nil,
        "Europe/Sarajevo": nil,
        "Europe/Simferopol": nil,
        "Europe/Skopje": nil,
        "Europe/Sofia": nil,
        "Europe/Tallinn": nil,
        "Europe/Tirane": nil,
        "Europe/Uzhgorod": nil,
        "Europe/Vaduz": nil,
        "Europe/Vatican": nil,
        "Europe/Vienna": nil,
        "Europe/Vilnius": nil,
        "Europe/Volgograd": nil,
        "Europe/Warsaw": nil,
        "Europe/Zagreb": nil,
        "Europe/Zaporozhye": nil,
        "Europe/Zurich": nil,
        "GMT": nil,
        "Indian/Antananarivo": nil,
        "Indian/Chagos": nil,
        "Indian/Christmas": nil,
        "Indian/Cocos": nil,
        "Indian/Comoro": nil,
        "Indian/Kerguelen": nil,
        "Indian/Mahe": nil,
        "Indian/Maldives": nil,
        "Indian/Mauritius": nil,
        "Indian/Mayotte": nil,
        "Indian/Reunion": nil,
        "Pacific/Apia": nil,
        "Pacific/Auckland": nil,
        "Pacific/Bougainville": nil,
        "Pacific/Chatham": nil,
        "Pacific/Chuuk": nil,
        "Pacific/Easter": nil,
        "Pacific/Efate": nil,
        "Pacific/Enderbury": nil,
        "Pacific/Fakaofo": nil,
        "Pacific/Fiji": nil,
        "Pacific/Funafuti": nil,
        "Pacific/Galapagos": nil,
        "Pacific/Gambier": nil,
        "Pacific/Guadalcanal": nil,
        "Pacific/Guam": nil,
        "Pacific/Honolulu": nil,
        "Pacific/Johnston": nil,
        "Pacific/Kiritimati": nil,
        "Pacific/Kosrae": nil,
        "Pacific/Kwajalein": nil,
        "Pacific/Majuro": nil,
        "Pacific/Marquesas": nil,
        "Pacific/Midway": nil,
        "Pacific/Nauru": nil,
        "Pacific/Niue": nil,
        "Pacific/Norfolk": nil,
        "Pacific/Noumea": nil,
        "Pacific/Pago_Pago": nil,
        "Pacific/Palau": nil,
        "Pacific/Pitcairn": nil,
        "Pacific/Pohnpei": nil,
        "Pacific/Ponape": nil,
        "Pacific/Port_Moresby": nil,
        "Pacific/Rarotonga": nil,
        "Pacific/Saipan": nil,
        "Pacific/Tahiti": nil,
        "Pacific/Tarawa": nil,
        "Pacific/Tongatapu": nil,
        "Pacific/Truk": nil,
        "Pacific/Wake": nil,
        "Pacific/Wallis": nil,
    ]

    static func currentDialingCode() -> String {
        let networkInfo = CTTelephonyNetworkInfo()
        if let mcc = networkInfo.subscriberCellularProvider?.mobileCountryCode, let dialingCode = mccToDialingCode[mcc] {
            return dialingCode
        }

        if let maybeDialingCode = timeZoneToDialingCode[TimeZone.autoupdatingCurrent.identifier], let dialingCode = maybeDialingCode {
            return dialingCode
        }

        return "+1"
    }
}
